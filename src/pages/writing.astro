---
import BaseLayout from '../layouts/BaseLayout.astro';
import WritingContent from '../components/WritingContent';
import { getCollection } from 'astro:content';

// Get all posts
let allPosts = [];
try {
  allPosts = await getCollection('posts');
} catch (e) {
  // Collection might not exist yet
  console.log('No posts collection found yet');
}

// Get language from URL for BaseLayout
const url = Astro.url;
const langParam = url.searchParams.get('lang');
const lang = (langParam === 'en' || langParam === 'ko') ? langParam : 'ko';

// Prepare posts data for client-side component
const postsData = allPosts.map(post => ({
  id: post.id,
  title: post.data.title,
  date: post.data.date,
  lang: post.data.lang,
  excerpt: post.data.excerpt || '',
}));
---

<BaseLayout title="Writing - Jeffrey Song" lang={lang}>
  <WritingContent client:load postsData={postsData} />
</BaseLayout>

